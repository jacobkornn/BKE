// Function to fetch account names by IDs from PowerApps Dataverse using Xrm.WebApi.retrieveMultipleRecords
async function getAccountNamesByIds(selectedItemIds) {
    const entityLogicalName = "account";
    const filter = selectedItemIds.map(id => `accountid eq ${id}`).join(" or ");
    const options = `?$select=name&$filter=${filter}`;

    try {
        const result = await Xrm.WebApi.retrieveMultipleRecords(entityLogicalName, options);
        const accountNames = result.entities.map(account => account.name);
        return accountNames;
    } catch (error) {
        console.error("Error:", error);
        return ["Unknown Account"];
    }
}

function openCustomPane(selectedItemIds) {
    //const viewId = "735b875d-3304-f011-bae3-000d3a9857fe"; // Set the view ID to "Edit Tags". This custom view will act as a sidepane
    
    Xrm.App.sidePanes.createPane({
        title: "Edit Tags",
        paneId: "EditTags",
        canClose: true
    }).then((pane) => {
        pane.navigate({
            pageType: "custom",
            name: "new_tagbulkedit_777ed",
            //viewId: viewId, // Specify the view ID here
            data: {
                selectedAccountIds: selectedItemIds
            }
        });
    });
}

// Function to handle selected item IDs
async function handleSelectedItems(selectedItemIds) {
    // Check if the selectedItemIds array is not empty
    if (selectedItemIds && selectedItemIds.length > 0) {
        const accountNames = await getAccountNamesByIds(selectedItemIds);
        console.log("Selected Item IDs:", selectedItemIds, "Account Names:", accountNames);
        openCustomPane(selectedItemIds);
    } else {
        console.log("No items selected.");
    }
}
